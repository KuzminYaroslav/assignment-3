## Part 1 — Data Preparation and Parsing

### 1. Load Raw Data
We first load the raw compressed JSON files. To handle the large single-object structure of the files, we increase the `maximum_object_size` buffer to 256MB.

```sql
-- Raw Games Data
CREATE OR REPLACE TABLE raw_games_source AS 
SELECT * FROM read_json_auto(
    'steam_2025_5k-dataset-games_20250831.json.gz',
    maximum_object_size=268435456
);

-- Raw Reviews Data
CREATE OR REPLACE TABLE raw_reviews_source AS 
SELECT * FROM read_json_auto(
    'steam_2025_5k-dataset-reviews_20250901.json.gz', 
    maximum_object_size=268435456
);
```

2. Create Structured Tables
We parse the nested JSON structures and unnest the arrays to create flat, analytical tables.

Table 1: Cleaned Games
Parsing Logic: We extract the data object from app_details.

Price Handling: Prices are converted from cents to units. COALESCE handles missing price data (typically free games).

Unnesting: The root games list is unnested to create one row per game.

```sql
CREATE OR REPLACE TABLE games_clean AS
SELECT 
    g.appid,
    g.app_details.data.name AS game_name,
    COALESCE(g.app_details.data.price_overview.final / 100.0, 0) AS price,
    g.app_details.data.price_overview.currency AS currency,
    g.app_details.data.release_date.date AS release_date,
    g.app_details.data.genres AS genres,
    g.app_details.data.developers AS developers,
    g.app_details.data.categories AS categories
FROM (
    SELECT unnest(games) as g 
    FROM raw_games_source
);
```

Table 2: Cleaned Reviews
Parsing Logic: Reviews are double-nested. We first unnest the root reviews list, then unnest the internal list found at review_data.reviews.

Aliasing Fix: We use AS t(review_item) to explicitly alias the struct column generated by the second unnest, preventing binder errors.

```sql
CREATE OR REPLACE TABLE reviews_clean AS
SELECT 
    r.appid,
    review_item.recommendationid AS review_id,
    review_item.author.steamid AS author_steamid,
    review_item.voted_up AS is_positive,
    review_item.votes_up AS votes_helpful,
    TRY_CAST(review_item.weighted_vote_score AS DOUBLE) AS vote_score,
    review_item.review AS review_text,
    to_timestamp(review_item.timestamp_created) AS created_at
FROM (
    SELECT unnest(reviews) as r 
    FROM raw_reviews_source
),
-- unnest the internal review
UNNEST(r.review_data.reviews) AS t(review_item);
```


Part 2 — Analytical Insights
1. Top 20 Games by Number of Reviews

```sql
SELECT 
    g.game_name,
    COUNT(r.review_id) AS review_count
FROM reviews_clean r
JOIN games_clean g ON r.appid = g.appid
GROUP BY g.game_name
ORDER BY review_count DESC
LIMIT 20;
```

Interpretation: The top games in this dataset (including Rust and Command & Conquer) are all capped at exactly 100 reviews. This indicates the dataset scraping process likely enforced a hard limit of 100 reviews per game ID.

2. Distribution of Game Release Years

```sql
SELECT 
    -- Extract the last 4 characters (Year) from the date string
    RIGHT(release_date, 4) AS release_year,
    COUNT(*) AS game_count
FROM games_clean
WHERE release_date IS NOT NULL
GROUP BY 1
ORDER BY 1 DESC;
```

Interpretation: The dataset is highly skewed toward recent releases, with the years 2024 and 2025 accounting for the vast majority of entries. This suggests the dataset is focused on "Upcoming" or "New Release" tabs rather than the historical Steam back catalog.

3. Average Price by Genre

```sql
SELECT 
    genre.description AS genre_name,
    ROUND(AVG(price), 2) AS avg_price
FROM games_clean,
UNNEST(genres) AS t(genre)
GROUP BY 1
ORDER BY 2 DESC
LIMIT 10;
```

Interpretation: Professional software categories like "Animation & Modeling" ($36.84) and "Design & Illustration" ($21.36) have a significantly higher average price point than mass-market entertainment genres like "Simulation" (~$14.77) or "Adventure" (~$16.00).

4. Most Common Tags (Categories)

```sql
SELECT 
    category.description AS tag_name,
    COUNT(*) AS tag_count
FROM games_clean,
UNNEST(categories) AS t(category)
GROUP BY 1
ORDER BY 2 DESC
LIMIT 10;
```

Interpretation: "Single-player" is the most ubiquitous tag, appearing in over 6,600 records. Social features like "Family Sharing" and "Steam Achievements" follow closely, highlighting that platform integration features are now standard for most modern releases.
